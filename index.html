<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CyberGator1 - Threat Hunting Command Center</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0e17;
      --panel: #131820;
      --darker: #0d1117;
      --accent: #00d9ff;
      --accent-dim: #0088aa;
      --text: #e6edf3;
      --text-muted: #8b949e;
      --border: #21262d;
      --success: #3fb950;
      --warning: #d29922;
      --danger: #f85149;
      --info: #58a6ff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.6;
    }

    header {
      background: var(--darker);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    header h1 {
      color: var(--accent);
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
    }

    header time {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .nav-tabs {
      display: flex;
      gap: 0;
      background: var(--panel);
      padding: 0 2rem;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 61px;
      z-index: 999;
      overflow-x: auto;
    }

    .nav-tab {
      background: transparent;
      color: var(--text-muted);
      border: none;
      border-bottom: 2px solid transparent;
      padding: 0.75rem 1.25rem;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    .nav-tab:hover {
      color: var(--accent);
      background: rgba(0, 217, 255, 0.05);
    }

    .nav-tab.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
      background: rgba(0, 217, 255, 0.08);
    }

    .content {
      flex-grow: 1;
      padding: 2rem;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.2s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 1.5rem;
    }

    .grid-full {
      grid-column: 1 / -1;
    }

    section {
      background: var(--panel);
      border-radius: 6px;
      padding: 1.5rem;
      border: 1px solid var(--border);
    }

    h2 {
      color: var(--text);
      border-bottom: 1px solid var(--border);
      padding-bottom: 0.5rem;
      margin-top: 0;
      margin-bottom: 1.5rem;
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    h2 i {
      color: var(--accent);
    }

    h3 {
      color: var(--text);
      font-size: 1rem;
      margin-top: 0;
      margin-bottom: 1rem;
      font-weight: 500;
    }

    select, button, input, textarea {
      background: var(--darker);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    select {
      width: 100%;
      margin-bottom: 1rem;
      cursor: pointer;
    }

    select:hover, select:focus {
      border-color: var(--accent-dim);
      outline: none;
    }

    button {
      cursor: pointer;
      margin: 0.25rem;
    }

    button:hover {
      border-color: var(--accent);
      background: rgba(0, 217, 255, 0.1);
    }

    button.primary {
      background: var(--accent);
      color: var(--bg);
      font-weight: 600;
      border: none;
    }

    button.primary:hover {
      background: var(--accent-dim);
    }

    input, textarea {
      width: 100%;
      margin-bottom: 1rem;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent-dim);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
      font-family: 'Consolas', monospace;
    }

    pre {
      background: var(--darker);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem;
      overflow-x: auto;
      font-size: 0.85rem;
      line-height: 1.5;
      position: relative;
      margin: 0;
    }

    .copy-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
      background: var(--accent);
      color: var(--bg);
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    .copy-btn:hover {
      background: var(--accent-dim);
    }

    .feed-container {
      max-height: 600px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .feed-item {
      background: var(--darker);
      padding: 1rem;
      border-left: 3px solid var(--accent);
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .feed-item:hover {
      background: rgba(0, 217, 255, 0.05);
      border-left-width: 4px;
    }

    .feed-item a {
      color: var(--accent);
      text-decoration: none;
      display: block;
      font-weight: 500;
      margin-bottom: 0.3rem;
    }

    .feed-item a:hover {
      text-decoration: underline;
    }

    .feed-item .meta {
      color: var(--text-muted);
      font-size: 0.8rem;
      margin-top: 0.3rem;
    }

    .feed-item .tags {
      margin-top: 0.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .tag {
      background: rgba(88, 166, 255, 0.15);
      color: var(--info);
      padding: 0.15rem 0.5rem;
      border-radius: 3px;
      font-size: 0.7rem;
      border: 1px solid var(--info);
    }

    .tag.critical { 
      background: rgba(248, 81, 73, 0.15); 
      color: var(--danger); 
      border-color: var(--danger); 
    }
    
    .tag.high { 
      background: rgba(210, 153, 34, 0.15); 
      color: var(--warning); 
      border-color: var(--warning); 
    }

    .intel-card {
      background: var(--darker);
      border: 1px solid var(--border);
      border-left: 3px solid var(--info);
      padding: 1rem;
      margin-bottom: 0.75rem;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .intel-card:hover {
      background: rgba(88, 166, 255, 0.05);
    }

    .intel-card.high { border-left-color: var(--danger); }
    .intel-card.medium { border-left-color: var(--warning); }
    .intel-card.low { border-left-color: var(--info); }

    .hypothesis-item {
      background: var(--darker);
      border: 1px solid var(--border);
      border-left: 3px solid var(--accent);
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 4px;
    }

    .hypothesis-item h4 {
      color: var(--accent);
      margin-top: 0;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    .hypothesis-item .context {
      color: var(--text-muted);
      font-size: 0.85rem;
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px solid var(--border);
    }

    .osint-keyboard {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .osint-key {
      background: var(--darker);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.3rem;
    }

    .osint-key:hover {
      background: var(--accent);
      color: var(--bg);
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .osint-key .letter {
      font-size: 1.5rem;
      font-weight: bold;
    }

    .osint-key .tool-name {
      font-size: 0.75rem;
    }

    .ioc-list {
      background: var(--darker);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem;
      max-height: 400px;
      overflow-y: auto;
      font-size: 0.85rem;
    }

    .ioc-item {
      padding: 0.4rem 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .ioc-item:last-child {
      border-bottom: none;
    }

    .ioc-type {
      color: var(--accent);
      font-size: 0.7rem;
      background: rgba(0, 217, 255, 0.15);
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      white-space: nowrap;
    }

    .loading {
      text-align: center;
      padding: 2rem;
      color: var(--text-muted);
    }

    .loading i {
      font-size: 2rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    footer {
      text-align: center;
      color: var(--text-muted);
      padding: 1.5rem;
      border-top: 1px solid var(--border);
      background: var(--darker);
      font-size: 0.85rem;
    }

    .filter-bar {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .filter-bar select,
    .filter-bar input {
      flex: 1;
      min-width: 150px;
      margin-bottom: 0;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat-card {
      background: var(--darker);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem;
      text-align: center;
    }

    .stat-card .value {
      font-size: 1.8rem;
      color: var(--accent);
      font-weight: 600;
    }

    .stat-card .label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.3rem;
    }

    .btn-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
      
      .nav-tabs {
        padding: 0 1rem;
      }
      
      .osint-keyboard {
        grid-template-columns: repeat(3, 1fr);
      }

      header {
        padding: 1rem;
      }

      .content {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-shield-alt"></i> CyberGator1</h1>
    <time id="clock"></time>
  </header>

  <div class="nav-tabs">
    <button class="nav-tab active" onclick="switchTab('intel')"><i class="fas fa-globe"></i> Threat Intel</button>
    <button class="nav-tab" onclick="switchTab('hypothesis')"><i class="fas fa-brain"></i> AI Hypothesis</button>
    <button class="nav-tab" onclick="switchTab('osint')"><i class="fas fa-keyboard"></i> OSINT Tools</button>
    <button class="nav-tab" onclick="switchTab('ioc')"><i class="fas fa-fingerprint"></i> IOC Extractor</button>
    <button class="nav-tab" onclick="switchTab('translator')"><i class="fas fa-language"></i> Query Translator</button>
    <button class="nav-tab" onclick="switchTab('queries')"><i class="fas fa-search"></i> Detection Queries</button>
  </div>

  <div class="content">
    <!-- Threat Intel Tab (First) -->
    <div id="tab-intel" class="tab-content active">
      <div class="grid">
        <section class="grid-full">
          <h2><i class="fas fa-rss"></i> Live Threat Intelligence Feed</h2>
          <div class="filter-bar">
            <select id="feedFilter" onchange="applyFeedFilters()">
              <option value="all">All Articles</option>
              <option value="today">Today</option>
              <option value="24h">Last 24 Hours</option>
              <option value="7d">Last 7 Days</option>
            </select>
            <input type="text" id="feedSearch" placeholder="Search articles..." oninput="applyFeedFilters()" />
            <button onclick="loadFeeds()"><i class="fas fa-sync-alt"></i> Refresh</button>
          </div>
          <div id="feedArea" class="feed-container">Loading latest threat intel...</div>
        </section>

        <section>
          <h2><i class="fas fa-shield-alt"></i> Active Global Threats</h2>
          <div id="intelCards" style="max-height: 500px; overflow-y: auto;">
            <div class="intel-card high">
              <strong>Scattered Spider (T1566, T1078, T1059)</strong><br>
              <small>Actively exploiting Okta & Azure AD tenants. Cloud credential theft campaign.</small><br>
              <em>Action:</em> Validate MFA, monitor PowerShell logs and login anomalies.
            </div>
            <div class="intel-card high">
              <strong>Akira Ransomware (T1486, T1567, T1105)</strong><br>
              <small>Exploiting Cisco AnyConnect misconfigurations and SMB exfil channels.</small><br>
              <em>Action:</em> Check lateral movement through SMB and anomalous data volume.
            </div>
            <div class="intel-card medium">
              <strong>APT42 (T1059, T1082, T1027)</strong><br>
              <small>Iranian threat actor leveraging PowerShell and encoded payloads.</small><br>
              <em>Action:</em> Hunt for Base64 encoded strings and unsigned scripts.
            </div>
            <div class="intel-card medium">
              <strong>RDP Brute-force Surge (T1110, T1078)</strong><br>
              <small>Global spike in brute-force attempts across exposed RDP endpoints.</small><br>
              <em>Action:</em> Restrict external RDP, enable lockouts, monitor EventID 4625.
            </div>
          </div>
        </section>

        <section>
          <h2><i class="fas fa-skull-crossbones"></i> Ransomware Victims</h2>
          <p style="color: var(--text-muted); font-size: 0.85rem;">
            Track ransomware campaigns via <a href="https://www.ransomware.live/" target="_blank" style="color: var(--accent);">Ransomware.live</a>
          </p>
          <div id="ransomwareVictims" style="background: var(--darker); padding: 1rem; border-radius: 6px; border: 1px solid var(--border); max-height: 300px; overflow-y: auto;">
            Loading ransomware victim data...
          </div>
        </section>
      </div>
    </div>

    <!-- AI Hypothesis Tab -->
    <div id="tab-hypothesis" class="tab-content">
      <section>
        <h2><i class="fas fa-brain"></i> AI-Powered Threat Hunting Hypothesis Generator</h2>
        <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
          Generate creative threat hunting hypotheses based on current threat intelligence feeds.
        </p>
        <button class="primary" onclick="generateHypothesis()" style="width: 100%; padding: 1rem;">
          <i class="fas fa-radiation"></i> Generate Hunting Hypotheses
        </button>
        <div id="hypothesisLoading" class="loading" style="display: none;">
          <i class="fas fa-spinner"></i>
          <p>Analyzing threat intelligence and generating hypotheses...</p>
        </div>
        <div id="hypothesisContainer" style="margin-top: 1.5rem;"></div>
      </section>
    </div>

    <!-- OSINT Tools Tab -->
    <div id="tab-osint" class="tab-content">
      <section>
        <h2><i class="fas fa-keyboard"></i> OSINT Keyboard Shortcuts</h2>
        <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
          Press any key (A-Z) or click to instantly open that OSINT tool. Perfect for rapid IOC investigation.
        </p>
        <div class="osint-keyboard" id="osintKeyboard"></div>
      </section>
    </div>

    <!-- IOC Extractor Tab -->
    <div id="tab-ioc" class="tab-content">
      <div class="grid">
        <section>
          <h2><i class="fas fa-fingerprint"></i> IOC Extractor</h2>
          <p style="color: var(--text-muted); margin-bottom: 1rem;">
            Paste threat intelligence text to automatically extract IPs, domains, URLs, and file hashes.
          </p>
          <textarea id="iocInput" placeholder="Paste threat intelligence reports, articles, or logs here..."></textarea>
          <button class="primary" onclick="extractIOCs()" style="width: 100%;">
            <i class="fas fa-search-plus"></i> Extract IOCs
          </button>
        </section>

        <section>
          <h2><i class="fas fa-list"></i> Extracted IOCs</h2>
          <div id="iocResults" class="ioc-list">
            <p style="color: var(--text-muted); text-align: center;">Extracted IOCs will appear here...</p>
          </div>
          <div class="btn-group" style="margin-top: 1rem;">
            <button onclick="exportIOCs('txt')"><i class="fas fa-file-alt"></i> Export TXT</button>
            <button onclick="exportIOCs('json')"><i class="fas fa-file-code"></i> Export JSON</button>
            <button onclick="exportIOCs('csv')"><i class="fas fa-file-csv"></i> Export CSV</button>
          </div>
        </section>
      </div>
    </div>

    <!-- Query Translator Tab -->
    <div id="tab-translator" class="tab-content">
      <div class="grid">
        <section>
          <h2><i class="fas fa-language"></i> Multi-Platform Query Translator</h2>
          <p style="color: var(--text-muted); margin-bottom: 1rem;">
            Convert detection queries between different SIEM platforms.
          </p>
          <label style="color: var(--text-muted); font-size: 0.85rem; display: block; margin-bottom: 0.3rem;">Source Platform:</label>
          <select id="sourcePlatform">
            <option value="kql">Microsoft Sentinel (KQL)</option>
            <option value="spl">Splunk (SPL)</option>
            <option value="lucene">Elastic (Lucene)</option>
          </select>
          <label style="color: var(--text-muted); font-size: 0.85rem; display: block; margin-bottom: 0.3rem;">Target Platform:</label>
          <select id="targetPlatform">
            <option value="spl" selected>Splunk (SPL)</option>
            <option value="kql">Microsoft Sentinel (KQL)</option>
            <option value="lucene">Elastic (Lucene)</option>
          </select>
          <label style="color: var(--text-muted); font-size: 0.85rem; display: block; margin-bottom: 0.3rem;">Enter Query:</label>
          <textarea id="sourceQuery" placeholder="Enter your detection query here..."></textarea>
          <button class="primary" onclick="translateQuery()" style="width: 100%;">
            <i class="fas fa-exchange-alt"></i> Translate Query
          </button>
        </section>

        <section>
          <h2><i class="fas fa-code"></i> Translated Query</h2>
          <div style="position: relative;">
            <button class="copy-btn" onclick="copyToClipboard('translatedQuery')"><i class="fas fa-copy"></i> Copy</button>
            <pre id="translatedQuery">Translated query will appear here...</pre>
          </div>
          <p style="color: var(--warning); font-size: 0.85rem; margin-top: 1rem;">
            <i class="fas fa-exclamation-triangle"></i> Note: Query translation is approximate. Manual adjustment may be required for complex queries.
          </p>
        </section>
      </div>
    </div>

    <!-- Detection Queries Tab (Moved to End) -->
    <div id="tab-queries" class="tab-content">
      <div class="grid">
        <section class="grid-full">
          <h2><i class="fas fa-code"></i> MITRE ATT&CK Detection Query Builder</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="value">5</div>
              <div class="label">SIEM Platforms</div>
            </div>
            <div class="stat-card">
              <div class="value">14</div>
              <div class="label">MITRE Techniques</div>
            </div>
            <div class="stat-card">
              <div class="value">70+</div>
              <div class="label">Detection Queries</div>
            </div>
            <div class="stat-card">
              <div class="value">Real-time</div>
              <div class="label">Threat Intel</div>
            </div>
          </div>
        </section>

        <section class="grid-full">
          <h3>Select MITRE Technique</h3>
          <select id="technique" onchange="showDetectionQuery()">
            <option value="">-- Select MITRE Technique --</option>
            <option value="T1059">T1059 - Command and Scripting Interpreter</option>
            <option value="T1566">T1566 - Phishing</option>
            <option value="T1021">T1021 - Remote Services</option>
            <option value="T1041">T1041 - Exfiltration Over C2 Channel</option>
            <option value="T1105">T1105 - Remote File Copy</option>
            <option value="T1547">T1547 - Boot or Logon Autostart Execution</option>
            <option value="T1071">T1071 - Application Layer Protocol</option>
            <option value="T1110">T1110 - Brute Force</option>
            <option value="T1055">T1055 - Process Injection</option>
            <option value="T1621">T1621 - Multi-Factor Authentication Fatigue</option>
            <option value="T1003">T1003 - Credential Dumping</option>
            <option value="T1078">T1078 - Valid Accounts</option>
            <option value="T1486">T1486 - Data Encrypted for Impact</option>
            <option value="T1567">T1567 - Exfiltration Over Web Service</option>
          </select>
          <div style="position: relative; margin-top: 1rem;">
            <button class="copy-btn" onclick="copyToClipboard('queryOutput')"><i class="fas fa-copy"></i> Copy</button>
            <pre id="queryOutput">Select a technique to view detection queries across multiple platforms.</pre>
          </div>
          <div class="btn-group" style="margin-top: 1rem;">
            <button onclick="exportQuery()"><i class="fas fa-download"></i> Export Query</button>
            <button onclick="saveToLibrary()"><i class="fas fa-save"></i> Save to Library</button>
          </div>
          <p style="color: var(--text-muted); text-align: center; margin-top: 1rem; font-size: 0.85rem;">
            Platforms: <strong>Microsoft Sentinel (KQL)</strong> | <strong>Splunk (SPL)</strong> | <strong>CrowdStrike Falcon</strong> | <strong>Elastic SIEM</strong> | <strong>Wazuh</strong>
          </p>
        </section>
      </div>
    </div>
  </div>

  <footer>
    <div style="margin-bottom: 0.5rem;">
      <i class="fas fa-shield-alt"></i> CyberGator1 - Threat Hunting Command Center
    </div>
    <div>
      Created by Pratik | Empowering the Cybersecurity Community
    </div>
  </footer>

  <script>
    // ==================== GLOBAL STATE ====================
    let currentTab = 'intel';
    let newsArticles = [];
    let allArticles = [];
    let extractedIOCs = { ips: [], domains: [], urls: [], hashes: [] };

    // ==================== TAB SWITCHING ====================
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');
      event.target.classList.add('active');
      currentTab = tabName;

      if (tabName === 'osint' && document.getElementById('osintKeyboard').children.length === 0) {
        loadOSINTKeyboard();
      }
    }

    // ==================== CORRECTED DETECTION QUERIES ====================
    const detections = {
      T1059: `Microsoft Sentinel (KQL):
DeviceProcessEvents
| where Timestamp > ago(1d)
| where FileName in~ ("powershell.exe", "cmd.exe", "cscript.exe", "wscript.exe")
| where ProcessCommandLine !contains "Windows\\System32"
| project Timestamp, DeviceName, AccountName, FileName, ProcessCommandLine

Splunk (SPL):
index=windows sourcetype=WinEventLog:Security EventCode=4688
(NewProcessName="*powershell.exe" OR NewProcessName="*cmd.exe" OR NewProcessName="*cscript.exe")
| table _time, Computer, SubjectUserName, NewProcessName, CommandLine

CrowdStrike Falcon (LogScale):
#event_simpleName=ProcessRollup2
FileName=/(powershell|cmd|cscript|wscript).exe/i
| table @timestamp, ComputerName, UserName, FileName, CommandLine

Elastic SIEM (Lucene):
event.category:process AND process.name:(powershell.exe OR cmd.exe OR cscript.exe OR wscript.exe)

Wazuh SIEM:
rule.id:(61603 OR 61604) OR rule.description:"Command*Interpreter"`,

      T1566: `Microsoft Sentinel (KQL):
EmailEvents
| where Timestamp > ago(7d)
| where Subject has_any ("urgent", "invoice", "account", "password", "verify")
| join kind=inner (EmailAttachmentInfo) on NetworkMessageId
| where FileName endswith ".exe" or FileName endswith ".js" or FileName endswith ".zip"
| project Timestamp, SenderFromAddress, RecipientEmailAddress, Subject, FileName

Splunk (SPL):
index=o365 sourcetype="o365:management:activity" Operation="MailItemsAccessed"
(subject="*invoice*" OR subject="*password*" OR subject="*urgent*")
| table _time, UserId, ClientIPAddress, subject, attachment_name

CrowdStrike Falcon (LogScale):
#event_simpleName=EmailAttachment
FileName=/\.(exe|js|zip|docm)$/i
| table @timestamp, SenderAddress, RecipientAddress, Subject, FileName

Elastic SIEM (Lucene):
event.category:email AND email.subject:(invoice OR password OR urgent) AND file.extension:(exe OR js OR zip)`,

      T1021: `Microsoft Sentinel (KQL):
SecurityEvent
| where EventID == 4624
| where LogonType in (3, 10)
| summarize LoginCount = count() by Account, IpAddress, Computer
| where LoginCount > 5
| extend Severity = iff(LoginCount > 20, "High", "Medium")

Splunk (SPL):
index=wineventlog EventCode=4624 (LogonType=3 OR LogonType=10)
| stats count by Account_Name, Source_Network_Address, ComputerName
| where count > 5

CrowdStrike Falcon (LogScale):
#event_simpleName=UserLogon
LogonType=/(Network|RemoteInteractive)/
| stats count() by UserName, RemoteIP, ComputerName
| count > 5`,

      T1041: `Microsoft Sentinel (KQL):
DeviceNetworkEvents
| where Timestamp > ago(1d)
| where RemotePort in (21, 22, 80, 443, 8080)
| where InitiatingProcessFileName in~ ("powershell.exe", "curl.exe", "wget.exe")
| summarize TotalBytes = sum(BytesSent) by DeviceName, RemoteIP, InitiatingProcessFileName
| where TotalBytes > 10485760

Splunk (SPL):
index=network dest_port IN (21, 22, 80, 443) bytes_out > 10485760
| stats sum(bytes_out) as total_bytes by src_ip, dest_ip, app
| where total_bytes > 10485760`,

      T1105: `Microsoft Sentinel (KQL):
DeviceNetworkEvents
| where Timestamp > ago(1d)
| where RemoteUrl matches regex @"\.(exe|dll|ps1|bat|vbs)$"
| where ActionType == "ConnectionSuccess"
| project Timestamp, DeviceName, RemoteUrl, RemoteIP, InitiatingProcessFileName

Splunk (SPL):
index=proxy (url="*.exe" OR url="*.dll" OR url="*.ps1")
| table _time, src_ip, dest_ip, url, bytes_in`,

      T1547: `Microsoft Sentinel (KQL):
DeviceRegistryEvents
| where RegistryKey has_any ("Run", "RunOnce", "RunServices", "Startup")
| where ActionType == "RegistryValueSet"
| project Timestamp, DeviceName, RegistryKey, RegistryValueName, RegistryValueData, InitiatingProcessFileName

Splunk (SPL):
index=windows sourcetype=WinRegistry key_path="*\\Run*"
| table _time, host, key_path, value_name, value_data`,

      T1071: `Microsoft Sentinel (KQL):
DeviceNetworkEvents
| where RemotePort !in (80, 443, 53)
| where InitiatingProcessFileName !in~ ("svchost.exe", "chrome.exe", "firefox.exe")
| summarize ConnectionCount = count() by DeviceName, RemoteIP, RemotePort, InitiatingProcessFileName
| where ConnectionCount > 50

CrowdStrike Falcon (LogScale):
#event_simpleName=NetworkConnectIP4
RemotePort!=/^(80|443|53)$/
| stats count() by ComputerName, RemoteAddressIP4, RemotePort
| count > 50`,

      T1110: `Microsoft Sentinel (KQL):
SecurityEvent
| where EventID == 4625
| where TimeGenerated > ago(1h)
| summarize FailedAttempts = count() by Account, IpAddress, Computer
| where FailedAttempts > 10
| extend Severity = case(FailedAttempts > 50, "Critical", FailedAttempts > 20, "High", "Medium")

Splunk (SPL):
index=windows EventCode=4625
| bucket _time span=1h
| stats count by _time, Account_Name, Source_Network_Address
| where count > 10

Elastic SIEM (Lucene):
event.code:4625
| aggregation: count by user.name, source.ip
| threshold: count > 10`,

      T1055: `Microsoft Sentinel (KQL):
DeviceProcessEvents
| where FileName in~ ("mavinject.exe", "rundll32.exe") or ProcessCommandLine has "inject"
| where ProcessCommandLine has_any ("VirtualAllocEx", "WriteProcessMemory", "CreateRemoteThread")
| project Timestamp, DeviceName, FileName, ProcessCommandLine, InitiatingProcessFileName

Splunk (SPL):
index=sysmon EventCode=8
(TargetImage="*rundll32.exe" OR TargetImage="*mavinject.exe" OR SourceImage="*inject*")
| table _time, Computer, SourceImage, TargetImage, GrantedAccess

CrowdStrike Falcon (LogScale):
#event_simpleName=ProcessRollup2
FileName=/(rundll32|mavinject).exe/i CommandLine=/inject/i
| table @timestamp, ComputerName, UserName, FileName, CommandLine`,

      T1621: `Microsoft Sentinel (KQL):
SigninLogs
| where TimeGenerated > ago(1h)
| where ResultType in ("50074", "50076")
| summarize MFADenials = count() by UserPrincipalName, AppDisplayName, IPAddress
| where MFADenials > 5
| extend RiskLevel = "High"

Splunk (SPL):
index=azure sourcetype="azure:aad:signin" ResultDescription="MFA denied"
| stats count by UserPrincipalName, IPAddress, AppDisplayName
| where count > 5`,

      T1003: `Microsoft Sentinel (KQL):
DeviceProcessEvents
| where FileName in~ ("mimikatz.exe", "procdump.exe") or ProcessCommandLine has_any ("sekurlsa", "lsadump", "lsass")
| project Timestamp, DeviceName, AccountName, FileName, ProcessCommandLine

Splunk (SPL):
index=sysmon (Image="*mimikatz.exe" OR CommandLine="*sekurlsa*" OR TargetImage="*lsass.exe")
| table _time, Computer, User, Image, CommandLine

CrowdStrike Falcon (LogScale):
#event_simpleName=ProcessRollup2
CommandLine=/(mimikatz|sekurlsa|lsadump)/i OR TargetFileName=lsass.exe
| table @timestamp, ComputerName, UserName, FileName, CommandLine`,

      T1078: `Microsoft Sentinel (KQL):
SigninLogs
| where ResultType == 0
| where TimeGenerated > ago(24h)
| summarize LoginCount = count(), Countries = make_set(Location) by UserPrincipalName, IPAddress
| where LoginCount > 50 or array_length(Countries) > 2

Splunk (SPL):
index=auth EventCode=4624 LogonType!=2
| stats count, dc(src_country) as countries by user, src_ip
| where count > 50 OR countries > 2`,

      T1486: `Microsoft Sentinel (KQL):
DeviceFileEvents
| where ActionType == "FileRenamed"
| where FileName matches regex @"\.(locked|encrypted|crypt|[a-z]{4,8})$"
| summarize EncryptedFiles = count() by DeviceName, InitiatingProcessFileName
| where EncryptedFiles > 50

Splunk (SPL):
index=sysmon EventCode=11
(TargetFilename="*.locked" OR TargetFilename="*.encrypted" OR TargetFilename="*.crypt")
| stats count by Computer, Image
| where count > 50

CrowdStrike Falcon (LogScale):
#event_simpleName=NewScriptWritten OR #event_simpleName=RansomwareFileEncryption
| stats count() by ComputerName, FileName
| count > 50`,

      T1567: `Microsoft Sentinel (KQL):
DeviceNetworkEvents
| where RemoteUrl has_any ("dropbox.com", "drive.google.com", "onedrive.com", "mega.nz", "wetransfer.com")
| summarize UploadBytes = sum(BytesSent) by DeviceName, AccountName, RemoteUrl
| where UploadBytes > 104857600

Splunk (SPL):
index=proxy (url="*dropbox.com*" OR url="*drive.google.com*" OR url="*mega.nz*")
bytes_out > 104857600
| stats sum(bytes_out) as total by src_user, url`
    };

    function showDetectionQuery() {
      const val = document.getElementById('technique').value;
      document.getElementById('queryOutput').textContent = detections[val] || "Select a technique to view detection queries across multiple SIEM/EDR platforms.";
    }

    function copyToClipboard(elementId) {
      const text = document.getElementById(elementId).textContent;
      navigator.clipboard.writeText(text).then(() => {
        const btn = event.target.closest('.copy-btn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        setTimeout(() => btn.innerHTML = originalText, 2000);
      }).catch(err => {
        alert('Failed to copy. Please select and copy manually.');
      });
    }

    function exportQuery() {
      const text = document.getElementById('queryOutput').textContent;
      if (text.includes('Select a technique')) {
        alert('Please select a technique first.');
        return;
      }
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'detection_query_' + new Date().toISOString().slice(0,10) + '.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    function saveToLibrary() {
      const technique = document.getElementById('technique').value;
      if (!technique) {
        alert('Please select a technique first.');
        return;
      }
      alert('Query saved to library! (This feature stores queries in browser localStorage)');
    }

    // ==================== ENHANCED THREAT INTEL FEEDS ====================
    const rssFeeds = [
      'https://www.bleepingcomputer.com/feed/',
      'https://feeds.feedburner.com/TheHackersNews',
      'https://threatpost.com/feed/',
      'https://www.darkreading.com/rss.xml',
      'https://krebsonsecurity.com/feed/',
      'https://www.securityweek.com/feed/',
      'https://nakedsecurity.sophos.com/feed/',
      'https://www.schneier.com/feed/atom/',
      'https://www.infosecurity-magazine.com/rss/news/',
      'https://www.cisa.gov/uscert/ncas/current-activity.xml',
      'https://www.zdnet.com/topic/security/rss.xml',
      'https://www.csoonline.com/index.rss',
      'https://www.helpnetsecurity.com/feed/',
      'https://www.scmagazine.com/feed/',
      'https://www.cyberscoop.com/feed/',
      'https://www.cybersecuritydive.com/feeds/news/',
      'https://www.databreachtoday.com/rss-feeds',
      'https://www.bankinfosecurity.com/rss-feeds',
      'https://www.govinfosecurity.com/rss-feeds',
      'https://www.healthcareinfosecurity.com/rss-feeds'
    ];

    async function fetchFeed(url) {
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000);
        const resp = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`, { signal: controller.signal });
        clearTimeout(timeoutId);
        if (!resp.ok) throw new Error('Fetch failed');
        const data = await resp.json();
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, "application/xml");
        return Array.from(doc.querySelectorAll("item, entry")).slice(0, 5).map(i => ({
          title: i.querySelector("title")?.textContent || 'No title',
          link: i.querySelector("link")?.textContent || i.querySelector("link")?.getAttribute("href") || '#',
          pubDate: i.querySelector("pubDate, updated")?.textContent || '',
          description: i.querySelector("description, summary")?.textContent || '',
          source: url
        }));
      } catch (e) {
        console.error('Feed error:', url, e);
        return [];
      }
    }

    async function loadFeeds() {
      const area = document.getElementById('feedArea');
      area.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>Loading feeds...</p></div>';
      allArticles = [];
      
      const promises = rssFeeds.map(feed => fetchFeed(feed));
      const results = await Promise.all(promises);
      
      results.forEach(items => {
        allArticles.push(...items.map(item => ({
          ...item,
          tags: autoTagArticle(item.title + ' ' + item.description)
        })));
      });

      allArticles.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
      newsArticles = allArticles;
      applyFeedFilters();
    }

    function autoTagArticle(text) {
      const tags = [];
      const lower = text.toLowerCase();
      if (lower.match(/ransom|lockbit|blackcat|alphv|akira/)) tags.push({ name: 'Ransomware', type: 'critical' });
      if (lower.match(/zero.?day|0.?day/)) tags.push({ name: 'Zero-Day', type: 'critical' });
      if (lower.match(/apt\d+|apt\s|nation.state|state.sponsor/)) tags.push({ name: 'APT', type: 'high' });
      if (lower.match(/phish|spear|bec|social.engineer/)) tags.push({ name: 'Phishing', type: 'high' });
      if (lower.match(/malware|trojan|backdoor|rat\s/)) tags.push({ name: 'Malware', type: 'high' });
      if (lower.match(/exploit|vulnerability|cve-\d/)) tags.push({ name: 'Exploit', type: 'high' });
      if (lower.match(/breach|leak|compromise|incident/)) tags.push({ name: 'Breach', type: 'high' });
      return tags;
    }

    function applyFeedFilters() {
      const timeFilter = document.getElementById('feedFilter').value;
      const searchTerm = document.getElementById('feedSearch').value.toLowerCase();
      
      let filtered = allArticles;
      
      // Time filter
      if (timeFilter !== 'all') {
        const now = new Date();
        filtered = filtered.filter(article => {
          const articleDate = new Date(article.pubDate);
          const diff = now - articleDate;
          switch(timeFilter) {
            case 'today': return now.toDateString() === articleDate.toDateString();
            case '24h': return diff <= 24*60*60*1000;
            case '7d': return diff <= 7*24*60*60*1000;
            default: return true;
          }
        });
      }
      
      // Search filter
      if (searchTerm) {
        filtered = filtered.filter(article => 
          (article.title + article.description).toLowerCase().includes(searchTerm)
        );
      }
      
      displayFeeds(filtered.slice(0, 30));
    }

    function displayFeeds(articles) {
      const area = document.getElementById('feedArea');
      if (articles.length === 0) {
        area.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No articles found matching your filters.</p>';
        return;
      }

      area.innerHTML = articles.map(item => `
        <div class="feed-item">
          <a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.title}</a>
          <div class="meta">${new Date(item.pubDate).toLocaleString() || 'Recent'}</div>
          ${item.tags.length > 0 ? `<div class="tags">
            ${item.tags.map(tag => `<span class="tag ${tag.type}">${tag.name}</span>`).join('')}
          </div>` : ''}
        </div>
      `).join('');
    }

    // ==================== AI HYPOTHESIS GENERATOR ====================
    function generateHypothesis() {
      const container = document.getElementById('hypothesisContainer');
      const loading = document.getElementById('hypothesisLoading');
      
      if (allArticles.length === 0) {
        alert('Please wait for threat intelligence feeds to load first.');
        return;
      }
      
      loading.style.display = 'block';
      container.innerHTML = '';

      setTimeout(() => {
        loading.style.display = 'none';
        const hypotheses = createHypotheses(allArticles.slice(0, 10));
        container.innerHTML = hypotheses.map((h, i) => `
          <div class="hypothesis-item">
            <h4>${i + 1}. ${h.title}</h4>
            <p><strong>Hypothesis:</strong> ${h.hypothesis}</p>
            <div class="context">
              <strong>Threat Context:</strong><br>
              ${h.context}
            </div>
          </div>
        `).join('');
      }, 1500);
    }

    function createHypotheses(articles) {
      const templates = [
        {
          title: (a) => `Hunt for shadow IT exploiting "${a.title.slice(0, 60)}..."`,
          hypothesis: (a) => `Monitor unsanctioned cloud uploads related to this threat by tracking unusual cloud service connections.`,
          context: (a) => `<ul style="margin: 0.5rem 0;"><li><strong>Insight:</strong> Employees may bypass security uploading data on ${new Date(a.pubDate).toLocaleDateString()}</li><li><strong>TTPs:</strong> Data Exfiltration (T1041), Cloud Service Abuse (T1567)</li><li><strong>Search:</strong> DeviceNetworkEvents | where RemoteUrl has_any ("dropbox", "drive.google")</li></ul>`
        },
        {
          title: (a) => `Investigate if "${a.title.slice(0, 60)}..." masks APT activity`,
          hypothesis: (a) => `This high-profile event may hide stealthier targeted attacks against your organization.`,
          context: (a) => `<ul style="margin: 0.5rem 0;"><li><strong>Insight:</strong> Attackers use public incidents to hide C2 traffic</li><li><strong>TTPs:</strong> Command and Control (T1071), Obfuscation (T1027)</li><li><strong>Search:</strong> Look for beaconing patterns in network logs</li></ul>`
        },
        {
          title: (a) => `Hunt for phishing campaigns mimicking "${a.title.slice(0, 60)}..."`,
          hypothesis: (a) => `Attackers weaponize breaking news to craft convincing phishing lures.`,
          context: (a) => `<ul style="margin: 0.5rem 0;"><li><strong>Insight:</strong> Phishing peaks within 24-48h of major security news</li><li><strong>TTPs:</strong> Spearphishing (T1566), Credential Harvesting</li><li><strong>Search:</strong> EmailEvents | where Subject contains keywords from article</li></ul>`
        },
        {
          title: (a) => `Investigate supply chain risk from "${a.title.slice(0, 60)}..."`,
          hypothesis: (a) => `Vendors mentioned may be compromised, creating downstream supply chain risk.`,
          context: (a) => `<ul style="margin: 0.5rem 0;"><li><strong>Insight:</strong> Third-party breaches cascade to customers</li><li><strong>TTPs:</strong> Supply Chain Compromise (T1195)</li><li><strong>Search:</strong> Monitor vendor-related authentication events</li></ul>`
        },
        {
          title: (a) => `Probe for insider threats amplifying "${a.title.slice(0, 60)}..."`,
          hypothesis: (a) => `Internal actors may leverage this incident to exfiltrate data while attention is diverted.`,
          context: (a) => `<ul style="margin: 0.5rem 0;"><li><strong>Insight:</strong> Insider threats spike during major security events</li><li><strong>TTPs:</strong> Data Staged (T1074), Removable Media (T1052)</li><li><strong>Search:</strong> Monitor USB connections and after-hours file access</li></ul>`
        }
      ];

      return articles.slice(0, 10).map((article, i) => {
        const template = templates[i % templates.length];
        return {
          title: template.title(article),
          hypothesis: template.hypothesis(article),
          context: template.context(article)
        };
      });
    }

    // ==================== OSINT KEYBOARD ====================
    const osintTools = [
      { key: 'A', name: 'AbuseIPDB', url: 'https://www.abuseipdb.com/check' },
      { key: 'B', name: 'BGPView', url: 'https://bgpview.io' },
      { key: 'C', name: 'Censys', url: 'https://search.censys.io' },
      { key: 'D', name: 'DNSTrails', url: 'https://securitytrails.com/domain' },
      { key: 'E', name: 'IPVoid', url: 'https://www.ipvoid.com/domain-reputation-check/' },
      { key: 'F', name: 'Fofa', url: 'https://en.fofa.info' },
      { key: 'G', name: 'GreyNoise', url: 'https://viz.greynoise.io/query' },
      { key: 'H', name: 'Hybrid Analysis', url: 'https://www.hybrid-analysis.com' },
      { key: 'I', name: 'IPinfo', url: 'https://ipinfo.io/' },
      { key: 'J', name: 'JoeSandbox', url: 'https://www.joesandbox.com' },
      { key: 'K', name: 'Kaspersky TI', url: 'https://opentip.kaspersky.com' },
      { key: 'L', name: 'DNSlytics', url: 'https://dnslytics.com/' },
      { key: 'M', name: 'Maltiverse', url: 'https://www.maltiverse.com/search' },
      { key: 'N', name: 'Netlas', url: 'https://app.netlas.io' },
      { key: 'O', name: 'Onyphe', url: 'https://www.onyphe.io' },
      { key: 'P', name: 'Pulsedive', url: 'https://pulsedive.com' },
      { key: 'Q', name: 'Talos Intel', url: 'https://www.talosintelligence.com/reputation_center' },
      { key: 'R', name: 'AlienVault OTX', url: 'https://otx.alienvault.com' },
      { key: 'S', name: 'Shodan', url: 'https://www.shodan.io/search' },
      { key: 'T', name: 'ThreatFox', url: 'https://threatfox.abuse.ch' },
      { key: 'U', name: 'URLScan', url: 'https://urlscan.io' },
      { key: 'V', name: 'VirusTotal', url: 'https://www.virustotal.com/gui/home/upload' },
      { key: 'W', name: 'WHOIS', url: 'https://whois.domaintools.com' },
      { key: 'X', name: 'X-Force', url: 'https://exchange.xforce.ibmcloud.com' },
      { key: 'Y', name: 'YARAify', url: 'https://yaraify.abuse.ch' },
      { key: 'Z', name: 'ZoomEye', url: 'https://www.zoomeye.org' }
    ];

    function loadOSINTKeyboard() {
      const container = document.getElementById('osintKeyboard');
      container.innerHTML = osintTools.map(tool => `
        <a href="${tool.url}" target="_blank" rel="noopener noreferrer" class="osint-key" accesskey="${tool.key.toLowerCase()}">
          <div class="letter">${tool.key}</div>
          <div class="tool-name">${tool.name}</div>
        </a>
      `).join('');
    }

    document.addEventListener('keydown', (e) => {
      if (currentTab === 'osint' && e.key.match(/[a-z]/i) && !e.ctrlKey && !e.altKey && !e.metaKey) {
        const tool = osintTools.find(t => t.key.toLowerCase() === e.key.toLowerCase());
        if (tool) {
          window.open(tool.url, '_blank');
          e.preventDefault();
        }
      }
    });

    // ==================== IOC EXTRACTOR ====================
    function extractIOCs() {
      const text = document.getElementById('iocInput').value;
      if (!text.trim()) {
        alert('Please paste some text first.');
        return;
      }
      
      extractedIOCs = { ips: [], domains: [], urls: [], hashes: [] };

      const ipRegex = /\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b/g;
      extractedIOCs.ips = [...new Set((text.match(ipRegex) || []).filter(ip => {
        const parts = ip.split('.');
        return parts.every(p => parseInt(p) <= 255 && parseInt(p) >= 0);
      }))];

      const domainRegex = /\b(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z]{2,}\b/gi;
      extractedIOCs.domains = [...new Set((text.match(domainRegex) || []).filter(d => 
        !d.match(/\.(exe|dll|txt|log|jpg|png|pdf)$/i) && d.includes('.') && !extractedIOCs.ips.includes(d)
      ))];

      const urlRegex = /https?:\/\/[^\s<>"{}|\\^`\[\]]+/gi;
      extractedIOCs.urls = [...new Set(text.match(urlRegex) || [])];

      const hashRegex = /\b[a-f0-9]{32}\b|\b[a-f0-9]{40}\b|\b[a-f0-9]{64}\b/gi;
      extractedIOCs.hashes = [...new Set(text.match(hashRegex) || [])];

      displayIOCs();
    }

    function displayIOCs() {
      const container = document.getElementById('iocResults');
      let html = '';
      let total = 0;

      const addSection = (title, items, type) => {
        if (items.length > 0) {
          html += `<div style="margin-bottom: 1rem;"><strong style="color: var(--accent);">${title} (${items.length})</strong></div>`;
          items.forEach(item => {
            html += `<div class="ioc-item"><code style="word-break: break-all;">${item}</code><span class="ioc-type">${type}</span></div>`;
          });
          total += items.length;
        }
      };

      addSection('IP Addresses', extractedIOCs.ips, 'IP');
      addSection('Domains', extractedIOCs.domains, 'DOMAIN');
      addSection('URLs', extractedIOCs.urls, 'URL');
      addSection('File Hashes', extractedIOCs.hashes, 'HASH');

      container.innerHTML = html || '<p style="text-align: center; color: var(--text-muted);">No IOCs extracted. Try pasting threat intelligence text.</p>';
      
      if (total > 0) {
        container.innerHTML = `<div style="background: var(--success); color: var(--bg); padding: 0.5rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-weight: 600;">Extracted ${total} IOCs</div>` + container.innerHTML;
      }
    }

    function exportIOCs(format) {
      const total = extractedIOCs.ips.length + extractedIOCs.domains.length + extractedIOCs.urls.length + extractedIOCs.hashes.length;
      if (total === 0) {
        alert('No IOCs to export. Please extract IOCs first.');
        return;
      }
      
      let content = '';
      const timestamp = new Date().toISOString().slice(0, 10);

      if (format === 'txt') {
        content = '=== IP Addresses ===\n' + extractedIOCs.ips.join('\n') + '\n\n';
        content += '=== Domains ===\n' + extractedIOCs.domains.join('\n') + '\n\n';
        content += '=== URLs ===\n' + extractedIOCs.urls.join('\n') + '\n\n';
        content += '=== File Hashes ===\n' + extractedIOCs.hashes.join('\n');
      } else if (format === 'json') {
        content = JSON.stringify(extractedIOCs, null, 2);
      } else if (format === 'csv') {
        content = 'Type,Value\n';
        extractedIOCs.ips.forEach(ip => content += `IP,${ip}\n`);
        extractedIOCs.domains.forEach(d => content += `Domain,${d}\n`);
        extractedIOCs.urls.forEach(u => content += `URL,${u}\n`);
        extractedIOCs.hashes.forEach(h => content += `Hash,${h}\n`);
      }

      const blob = new Blob([content], { type: format === 'json' ? 'application/json' : 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `iocs_${timestamp}.${format}`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // ==================== QUERY TRANSLATOR ====================
    function translateQuery() {
      const source = document.getElementById('sourcePlatform').value;
      const target = document.getElementById('targetPlatform').value;
      const query = document.getElementById('sourceQuery').value;

      if (!query.trim()) {
        alert('Please enter a query to translate.');
        return;
      }

      if (source === target) {
        alert('Source and target platforms are the same. Please select different platforms.');
        return;
      }

      let translated = query;

      if (source === 'kql' && target === 'spl') {
        translated = query
          .replace(/\| where/g, '| search')
          .replace(/has_any/g, 'IN')
          .replace(/contains/g, 'like')
          .replace(/\| project/g, '| table')
          .replace(/\| summarize/g, '| stats');
      } else if (source === 'spl' && target === 'kql') {
        translated = query
          .replace(/\| search/g, '| where')
          .replace(/\| table/g, '| project')
          .replace(/\| stats/g, '| summarize');
      } else if (target === 'lucene') {
        translated = '// Lucene conversion requires manual adaptation\n' + query;
      }

      document.getElementById('translatedQuery').textContent = translated;
    }

    // ==================== RANSOMWARE VICTIMS ====================
    async function loadRansomwareVictims() {
      document.getElementById('ransomwareVictims').innerHTML = `
        <p style="color: var(--text-muted); text-align: center; padding: 1rem;">
          For the latest ransomware victim disclosures, visit:<br><br>
          <a href="https://www.ransomware.live/" target="_blank" rel="noopener noreferrer" style="color: var(--accent); text-decoration: none; font-weight: 600;">
            <i class="fas fa-external-link-alt"></i> Ransomware.live
          </a>
        </p>
      `;
    }

    // ==================== INITIALIZATION ====================
    setInterval(() => {
      document.getElementById('clock').textContent = new Date().toLocaleString();
    }, 1000);

    window.addEventListener('load', () => {
      showDetectionQuery();
      loadFeeds();
      loadRansomwareVictims();
    });
  </script>
</body>
</html>