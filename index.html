<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CyberGator1 - Threat Hunting Command Center</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    :root{--bg-primary:#fff;--bg-secondary:#f8f9fa;--bg-tertiary:#f1f3f5;--surface:#fff;--text-primary:#202124;--text-secondary:#5f6368;--text-tertiary:#80868b;--border:#e8eaed;--border-strong:#dadce0;--accent:#1a73e8;--accent-hover:#1557b0;--accent-light:#e8f0fe;--success:#137333;--success-light:#e6f4ea;--warning:#f9ab00;--warning-light:#fef7e0;--danger:#d93025;--danger-light:#fce8e6;--info:#1967d2;--shadow-sm:0 1px 2px 0 rgba(60,64,67,.1);--shadow:0 1px 3px 0 rgba(60,64,67,.15);--radius:8px;--radius-lg:12px}
    [data-theme="dark"]{--bg-primary:#1a1a1a;--bg-secondary:#0f0f0f;--bg-tertiary:#262626;--surface:#1f1f1f;--text-primary:#e8eaed;--text-secondary:#9aa0a6;--text-tertiary:#80868b;--border:#3c4043;--border-strong:#5f6368;--accent:#8ab4f8;--accent-hover:#aecbfa;--accent-light:#1a2e4a;--success:#81c995;--success-light:#1e3a28;--warning:#fdd663;--warning-light:#3d3420;--danger:#f28b82;--danger-light:#3d2120;--info:#78d9ec;--shadow-sm:0 1px 3px 0 rgba(0,0,0,.3);--shadow:0 2px 6px 0 rgba(0,0,0,.4)}
    *{box-sizing:border-box;margin:0;padding:0}body{background:var(--bg-secondary);color:var(--text-primary);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;line-height:1.6;font-size:15px;transition:background .3s ease,color .3s ease}header{background:var(--surface);border-bottom:1px solid var(--border);padding:1rem 2rem;position:sticky;top:0;z-index:1000;box-shadow:var(--shadow-sm)}header .container{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}header h1{color:var(--text-primary);font-size:1.5rem;font-weight:500;display:flex;align-items:center;gap:.5rem}header h1 i{color:var(--accent)}header time{color:var(--text-tertiary);font-size:.875rem}#themeToggle{background:var(--bg-tertiary);border:1px solid var(--border);color:var(--text-primary);padding:.5rem .875rem;border-radius:var(--radius);cursor:pointer;font-size:.875rem;transition:all .2s ease;display:flex;align-items:center;gap:.5rem}#themeToggle:hover{background:var(--bg-primary);border-color:var(--accent)}.nav-tabs{background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:65px;z-index:999;overflow-x:auto;scrollbar-width:none}.nav-tabs::-webkit-scrollbar{display:none}.nav-tabs .container{max-width:1400px;margin:0 auto;display:flex;gap:0;padding:0 2rem}.nav-tab{background:0 0;color:var(--text-secondary);border:none;border-bottom:2px solid transparent;padding:.875rem 1rem;cursor:pointer;transition:all .15s ease;font-size:.875rem;font-weight:500;white-space:nowrap}.nav-tab:hover{color:var(--accent);background:var(--accent-light)}.nav-tab.active{color:var(--accent);border-bottom-color:var(--accent)}.content{max-width:1400px;margin:0 auto;padding:2rem}.tab-content{display:none}.tab-content.active{display:block;animation:fadeIn .2s ease-in}@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:1.5rem}.grid-full{grid-column:1/-1}section{background:var(--surface);border-radius:var(--radius-lg);padding:1.5rem;border:1px solid var(--border);box-shadow:var(--shadow-sm);transition:all .3s ease}h2{color:var(--text-primary);font-size:1.125rem;font-weight:500;margin-bottom:1.25rem;display:flex;align-items:center;gap:.5rem}h2 i{color:var(--accent);font-size:1rem}h3{color:var(--text-primary);font-size:1rem;font-weight:500;margin-bottom:1rem}button,input,select,textarea{font-family:inherit;font-size:.875rem;border-radius:var(--radius);transition:all .15s ease}input,select,textarea{background:var(--surface);color:var(--text-primary);border:1px solid var(--border-strong);padding:.625rem .875rem;width:100%}input:hover,select:hover,textarea:hover{border-color:var(--text-tertiary)}input:focus,select:focus,textarea:focus{outline:0;border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-light)}textarea{min-height:120px;resize:vertical;font-family:Monaco,'Courier New',monospace;line-height:1.5}button{background:var(--surface);color:var(--text-primary);border:1px solid var(--border-strong);padding:.625rem 1rem;cursor:pointer;font-weight:500}button:hover{background:var(--bg-tertiary);border-color:var(--text-tertiary)}button.primary{background:var(--accent);color:#fff;border:none}button.primary:hover{background:var(--accent-hover)}pre{background:var(--bg-tertiary);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;overflow-x:auto;font-size:.8125rem;line-height:1.5;position:relative;font-family:Monaco,'Courier New',monospace}.copy-btn{position:absolute;top:.5rem;right:.5rem;padding:.375rem .75rem;font-size:.75rem}.feed-container{max-height:700px;overflow-y:auto;display:flex;flex-direction:column;gap:1.25rem;padding-right:.5rem}.feed-container::-webkit-scrollbar{width:6px}.feed-container::-webkit-scrollbar-track{background:var(--bg-tertiary);border-radius:3px}.feed-container::-webkit-scrollbar-thumb{background:var(--border-strong);border-radius:3px}.feed-container::-webkit-scrollbar-thumb:hover{background:var(--text-tertiary)}.feed-item{background:var(--surface);padding:1.5rem;border-left:4px solid var(--accent);border-radius:var(--radius-lg);transition:all .2s ease;box-shadow:var(--shadow-sm);border:1px solid var(--border)}.feed-item:hover{box-shadow:var(--shadow);transform:translateX(4px);border-left-color:var(--accent-hover)}.feed-item a{color:var(--accent);text-decoration:none;display:block;font-weight:600;margin-bottom:.875rem;line-height:1.5;font-size:1.05rem}.feed-item a:hover{text-decoration:underline;color:var(--accent-hover)}.feed-item .description{color:var(--text-secondary);font-size:.95rem;line-height:1.7;margin-bottom:.875rem;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.feed-item .meta{color:var(--text-tertiary);font-size:.8125rem;display:flex;align-items:center;gap:1.25rem;margin-bottom:.875rem;flex-wrap:wrap}.feed-item .meta span{display:flex;align-items:center;gap:.375rem}.feed-item .tags{display:flex;flex-wrap:wrap;gap:.625rem}.tag{background:var(--bg-tertiary);color:var(--text-secondary);padding:.375rem .75rem;border-radius:6px;font-size:.75rem;font-weight:600;border:1px solid var(--border);text-transform:uppercase;letter-spacing:.3px}.tag.critical{background:var(--danger-light);color:var(--danger);border-color:var(--danger)}.tag.high{background:var(--warning-light);color:var(--warning);border-color:var(--warning)}.tag.success{background:var(--success-light);color:var(--success);border-color:var(--success)}.threat-card{background:var(--surface);border:1px solid var(--border);border-left:4px solid var(--danger);padding:1.25rem;margin-bottom:1rem;border-radius:var(--radius);transition:all .15s ease}.threat-card:hover{box-shadow:var(--shadow)}.threat-card.critical{border-left-color:var(--danger)}.threat-card.high{border-left-color:var(--warning)}.threat-card.medium{border-left-color:var(--info)}.threat-card h4{color:var(--text-primary);font-size:.9375rem;font-weight:500;margin-bottom:.75rem}.threat-card .description{color:var(--text-secondary);font-size:.875rem;line-height:1.6;margin-bottom:.75rem}.threat-card .action{color:var(--text-secondary);font-size:.8125rem;padding-top:.75rem;border-top:1px solid var(--border);line-height:1.5}.threat-card .action strong{color:var(--accent)}.hypothesis-item{background:var(--bg-secondary);border:1px solid var(--border);border-left:3px solid var(--accent);padding:1.25rem;margin-bottom:1rem;border-radius:var(--radius)}.hypothesis-item h4{color:var(--text-primary);font-size:.9375rem;font-weight:500;margin-bottom:.75rem}.hypothesis-item p{color:var(--text-secondary);font-size:.875rem;line-height:1.5;margin-bottom:.5rem}.hypothesis-item .context{color:var(--text-secondary);font-size:.8125rem;padding-top:.75rem;border-top:1px solid var(--border);line-height:1.6}.osint-keyboard{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:.75rem}.osint-key{background:var(--surface);border:1px solid var(--border-strong);border-radius:var(--radius);padding:1rem;text-align:center;cursor:pointer;transition:all .15s ease;text-decoration:none;color:var(--text-primary);display:flex;flex-direction:column;align-items:center;gap:.375rem}.osint-key:hover{background:var(--accent);color:#fff;border-color:var(--accent);transform:translateY(-2px);box-shadow:var(--shadow)}.osint-key .letter{font-size:1.5rem;font-weight:600}.osint-key .tool-name{font-size:.6875rem;font-weight:500}.ioc-list{background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;max-height:400px;overflow-y:auto}.ioc-item{padding:.625rem 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:1rem}.ioc-item:last-child{border-bottom:none}.ioc-type{color:var(--accent);font-size:.6875rem;font-weight:500;background:var(--accent-light);padding:.25rem .5rem;border-radius:4px;white-space:nowrap}.loading{text-align:center;padding:3rem;color:var(--text-tertiary)}.loading i{font-size:2rem;animation:spin 1s linear infinite;color:var(--accent)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}footer{text-align:center;color:var(--text-tertiary);padding:2rem;background:var(--surface);border-top:1px solid var(--border);font-size:.875rem}.filter-bar{display:flex;gap:.75rem;margin-bottom:1.25rem;flex-wrap:wrap}.filter-bar input,.filter-bar select{flex:1;min-width:180px}.filter-bar button{flex-shrink:0}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:1.5rem}.stat-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);padding:1.25rem;text-align:center}.stat-card .value{font-size:1.875rem;color:var(--accent);font-weight:600;line-height:1}.stat-card .label{font-size:.8125rem;color:var(--text-secondary);margin-top:.5rem}.btn-group{display:flex;gap:.75rem;flex-wrap:wrap}.alert{background:var(--accent-light);border:1px solid var(--accent);border-radius:var(--radius);padding:.875rem 1rem;margin-bottom:1rem;color:var(--text-primary);font-size:.875rem;display:flex;align-items:center;gap:.75rem}.alert i{color:var(--accent)}.alert.warning{background:var(--warning-light);border-color:var(--warning);color:var(--text-primary)}.alert.warning i{color:var(--warning)}@media (max-width:768px){.grid{grid-template-columns:1fr}.nav-tabs .container{padding:0 1rem}.osint-keyboard{grid-template-columns:repeat(3,1fr)}header .container,.content{padding-left:1rem;padding-right:1rem}}
  </style>
</head>
<body data-theme="light">
  <header>
    <div class="container">
      <h1><i class="fas fa-shield-alt"></i> CyberGator1</h1>
      <div style="display:flex;align-items:center;gap:1rem">
        <time id="clock"></time>
        <button id="themeToggle" onclick="toggleTheme()" title="Toggle theme">
          <i class="fas fa-moon" id="themeIcon"></i>
          <span id="themeText">Dark</span>
        </button>
      </div>
    </div>
  </header>

  <div class="nav-tabs">
    <div class="container">
      <button class="nav-tab active" onclick="switchTab('intel')"><i class="fas fa-globe"></i> Threat Intel</button>
      <button class="nav-tab" onclick="switchTab('hypothesis')"><i class="fas fa-brain"></i> AI Hypothesis</button>
      <button class="nav-tab" onclick="switchTab('osint')"><i class="fas fa-keyboard"></i> OSINT Tools</button>
      <button class="nav-tab" onclick="switchTab('ioc')"><i class="fas fa-fingerprint"></i> IOC Extractor</button>
      <button class="nav-tab" onclick="switchTab('queries')"><i class="fas fa-search"></i> Detection Queries</button>
    </div>
  </div>

  <div class="content">
    <div id="tab-intel" class="tab-content active">
      <div class="grid">
        <section class="grid-full">
          <h2><i class="fas fa-newspaper"></i> Latest Cybersecurity News</h2>
          <div class="filter-bar">
            <select id="feedFilter" onchange="applyFeedFilters()">
              <option value="all">All Time</option>
              <option value="today">Today</option>
              <option value="24h" selected>Last 24 Hours</option>
              <option value="7d">Last 7 Days</option>
            </select>
            <input type="text" id="feedSearch" placeholder="Search articles..." oninput="applyFeedFilters()" />
            <button onclick="loadFeeds()"><i class="fas fa-sync-alt"></i> Refresh</button>
          </div>
          <div id="feedArea" class="feed-container"><div class="loading"><i class="fas fa-spinner"></i><p>Loading feeds...</p></div></div>
        </section>
        <section>
          <h2><i class="fas fa-exclamation-triangle"></i> Active Threats</h2>
          <div id="activeThreatCards" style="max-height:700px;overflow-y:auto"></div>
        </section>
        <section>
          <h2><i class="fas fa-chart-line"></i> Metrics</h2>
          <div id="threatMetrics"><div class="threat-card medium"><h4>Ransomware (Nov 2025)</h4><div class="description"><strong>727 attacks</strong> globally, <strong>22% increase</strong> YoY.</div><div class="action"><strong>Top Groups:</strong> Qilin (15%), Clop (15%)</div></div></div>
        </section>
      </div>
    </div>
    <div id="tab-hypothesis" class="tab-content"><section><h2><i class="fas fa-brain"></i> AI Hypothesis Generator</h2><button class="primary" onclick="generateHypothesis()" style="width:100%;padding:.875rem"><i class="fas fa-radiation"></i> Generate Hypotheses</button><div id="hypothesisLoading" class="loading" style="display:none"><i class="fas fa-spinner"></i><p>Generating...</p></div><div id="hypothesisContainer" style="margin-top:1.5rem"></div></section></div>
    <div id="tab-osint" class="tab-content"><section><h2><i class="fas fa-keyboard"></i> OSINT Tools</h2><div class="alert"><i class="fas fa-info-circle"></i><span>Press any key (A-Z) or click to instantly open that OSINT tool in a new tab. Perfect for rapid IOC investigation.</span></div><div id="osintKeyboard" class="osint-keyboard"></div></section></div>
    <div id="tab-ioc" class="tab-content"><div class="grid"><section><h2><i class="fas fa-fingerprint"></i> IOC Extractor</h2><div class="alert"><i class="fas fa-info-circle"></i><span>Automatically extracts and defangs IPs (8[.]8[.]8[.]8 → 8.8.8.8), domains, URLs, and file hashes from threat intelligence text.</span></div><textarea id="iocInput" placeholder="Paste threat intel here...\n\nExample:\nMalicious IP: 192[.]168[.]1[.]1\nDomain: evil[.]example[.]com\nHash: d41d8cd98f00b204e9800998ecf8427e"></textarea><button class="primary" onclick="extractIOCs()" style="width:100%;margin-top:.75rem"><i class="fas fa-search-plus"></i> Extract IOCs</button></section><section><h2><i class="fas fa-list"></i> Extracted IOCs</h2><div id="iocResults" class="ioc-list"><p style="color:var(--text-tertiary);text-align:center;padding:2rem 0">IOCs will appear here...</p></div><div class="btn-group" style="margin-top:1rem"><button onclick="exportIOCs('txt')"><i class="fas fa-file-alt"></i> Export TXT</button><button onclick="exportIOCs('json')"><i class="fas fa-file-code"></i> Export JSON</button><button onclick="exportIOCs('csv')"><i class="fas fa-file-csv"></i> Export CSV</button></div></section></div></div>
    
    <div id="tab-queries" class="tab-content">
      <div class="grid">
        <section class="grid-full">
          <h2><i class="fas fa-code"></i> Threat Hunting Query Library</h2>
          
          <div class="alert warning">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
              <strong>⚠️ DISCLAIMER:</strong> These queries are <strong>starter templates only</strong>. Always validate and tune for your environment before production use. Modify thresholds, time windows, field names, and logic to match your data sources and baselines.
            </div>
          </div>

          <div class="stats-grid">
            <div class="stat-card"><div class="value">3</div><div class="label">Platforms</div></div>
            <div class="stat-card"><div class="value">5</div><div class="label">Hunt Categories</div></div>
            <div class="stat-card"><div class="value">20</div><div class="label">Hunt Queries</div></div>
          </div>

          <div class="filter-bar">
            <select id="queryPlatform" onchange="updateQueryCategories()">
              <option value="">-- Select Platform --</option>
              <option value="sentinel">Microsoft Sentinel (KQL)</option>
              <option value="defender">Microsoft Defender XDR (KQL)</option>
              <option value="crowdstrike">CrowdStrike Falcon</option>
            </select>
            <select id="queryCategory" onchange="updateQueryList()" disabled>
              <option value="">-- Select Category --</option>
            </select>
            <select id="queryName" onchange="displayQuery()" disabled>
              <option value="">-- Select Hunt Query --</option>
            </select>
          </div>

          <div id="queryDetailsContainer" style="display:none">
            <div style="background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;margin-bottom:1rem">
              <div style="display:flex;justify-content:space-between;align-items:start;flex-wrap:wrap;gap:1rem">
                <div>
                  <h3 id="queryTitle" style="margin-bottom:.5rem">Query Name</h3>
                  <p id="queryDescription" style="color:var(--text-secondary);font-size:.875rem;margin-bottom:.5rem"></p>
                  <div id="queryMitre" style="display:flex;gap:.5rem;flex-wrap:wrap"></div>
                </div>
                <div style="text-align:right">
                  <div style="font-size:.75rem;color:var(--text-tertiary);margin-bottom:.25rem">Platform</div>
                  <div id="queryPlatformTag" style="background:var(--accent-light);color:var(--accent);padding:.375rem .75rem;border-radius:6px;font-size:.75rem;font-weight:600;border:1px solid var(--accent)"></div>
                </div>
              </div>
            </div>

            <div style="position:relative">
              <button class="copy-btn" onclick="copyToClipboard('queryOutput')"><i class="fas fa-copy"></i> Copy</button>
              <pre id="queryOutput"></pre>
            </div>

            <div class="alert" style="margin-top:1rem">
              <i class="fas fa-lightbulb"></i>
              <span><strong>Next Step:</strong> Test this query in your SIEM, validate results, tune thresholds, then convert to a scheduled Analytics Rule or Custom Detection for continuous monitoring.</span>
            </div>
          </div>

          <div id="queryPlaceholder" style="text-align:center;padding:3rem;color:var(--text-tertiary)">
            <i class="fas fa-search" style="font-size:3rem;margin-bottom:1rem;opacity:.3"></i>
            <p>Select a platform, category, and hunt query to begin</p>
          </div>
        </section>
      </div>
    </div>
  </div>

  <footer><div><strong>CyberGator1</strong> - Threat Hunting Command Center</div><div style="margin-top:.5rem">Created by Pratik</div></footer>

  <script>
let currentTab='intel',allArticles=[];

// THREAT HUNTING QUERY DATABASE
const huntingQueries={
  sentinel:{
    'Credential Access':[
      {name:'MFA Fatigue - Multiple Denials',mitre:['T1621'],desc:'Detect MFA push notification spam attacks where users receive excessive auth prompts',query:`// Hunt: MFA Fatigue Attack Detection\n// Author: Threat Hunting Team\n// MITRE: T1621 - Multi-Factor Authentication Request Generation\n\nSigninLogs\n| where TimeGenerated > ago(1h)\n| where ResultType in ("50074", "50076") // MFA denied\n| summarize DenialCount=count(), Countries=make_set(Location) by UserPrincipalName, IPAddress, bin(TimeGenerated, 5m)\n| where DenialCount >= 5\n| project TimeGenerated, UserPrincipalName, IPAddress, DenialCount, Countries\n| order by DenialCount desc\n\n// TUNE: Adjust DenialCount threshold based on your baseline\n// VALIDATE: Check if user eventually authenticated successfully after denials`},
      {name:'Credential Dumping - LSASS Access',mitre:['T1003.001'],desc:'Hunt for suspicious process access to LSASS memory (credential theft)',query:`// Hunt: LSASS Memory Access Detection\n// MITRE: T1003.001 - LSASS Memory Dumping\n\nDeviceProcessEvents\n| where Timestamp > ago(24h)\n| where FileName in~ ("procdump.exe", "procdump64.exe", "mimikatz.exe") \n    or ProcessCommandLine has_any ("lsass", "sekurlsa", "logonpasswords")\n| project Timestamp, DeviceName, AccountName, FileName, ProcessCommandLine, InitiatingProcessFileName\n| order by Timestamp desc\n\n// VALIDATE: Legitimate admin tools may trigger this - correlate with ticketing system\n// TUNE: Add exclusions for authorized PAM solutions`},
      {name:'Password Spray Attack',mitre:['T1110.003'],desc:'Identify potential password spray across multiple accounts from single source',query:`// Hunt: Password Spray Detection\n// MITRE: T1110.003 - Password Spraying\n\nSigninLogs\n| where TimeGenerated > ago(1h)\n| where ResultType != 0 // Failed logins\n| summarize \n    FailedAccounts=dcount(UserPrincipalName),\n    AttemptedUsers=make_set(UserPrincipalName, 10),\n    FailureCount=count()\n    by IPAddress, bin(TimeGenerated, 10m)\n| where FailedAccounts >= 10\n| project TimeGenerated, IPAddress, FailedAccounts, FailureCount, AttemptedUsers\n| order by FailedAccounts desc\n\n// TUNE: Adjust FailedAccounts based on org size\n// ENRICH: Join with threat intel feeds for known malicious IPs`}
    ],
    'Lateral Movement':[
      {name:'RDP from Unusual Geographic Location',mitre:['T1021.001'],desc:'Hunt for RDP connections originating from countries not in your baseline',query:`// Hunt: Anomalous RDP Geolocation\n// MITRE: T1021.001 - Remote Desktop Protocol\n\nSecurityEvent\n| where TimeGenerated > ago(24h)\n| where EventID == 4624 and LogonType == 10 // RDP logon\n| extend GeoInfo = geo_info_from_ip_address(IpAddress)\n| extend Country = tostring(GeoInfo.country)\n| where Country !in ("United States", "Canada") // TUNE: Add your expected countries\n| summarize LoginCount=count() by Account, IpAddress, Country, Computer\n| where LoginCount >= 1\n| project TimeGenerated, Account, IpAddress, Country, Computer, LoginCount\n| order by TimeGenerated desc\n\n// VALIDATE: Check if user is traveling or using VPN\n// TUNE: Maintain whitelist of approved VPN exit nodes`},
      {name:'SMB Lateral Movement - Rare File Shares',mitre:['T1021.002'],desc:'Detect connections to administrative shares (C$, ADMIN$) from workstations',query:`// Hunt: Administrative Share Access\n// MITRE: T1021.002 - SMB/Windows Admin Shares\n\nDeviceNetworkEvents\n| where Timestamp > ago(24h)\n| where RemotePort == 445\n| where RemoteUrl has_any ("C$", "ADMIN$", "IPC$")\n| where DeviceName !has "server" // TUNE: Exclude legitimate servers\n| summarize ConnectionCount=count() by DeviceName, RemoteIP, RemoteUrl, InitiatingProcessFileName\n| where ConnectionCount >= 3\n| order by ConnectionCount desc\n\n// VALIDATE: IT admin workstations may trigger false positives\n// ENRICH: Correlate with ServiceNow tickets for authorized changes`}
    ],
    'Persistence':[
      {name:'Registry Run Key Modification',mitre:['T1547.001'],desc:'Hunt for new persistence via registry Run/RunOnce keys',query:`// Hunt: Registry Persistence Detection\n// MITRE: T1547.001 - Boot or Logon Autostart (Registry)\n\nDeviceRegistryEvents\n| where Timestamp > ago(7d)\n| where ActionType == "RegistryValueSet"\n| where RegistryKey has_any (\n    "\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run",\n    "\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce"\n)\n| where InitiatingProcessFileName !in~ ("msiexec.exe", "setup.exe") // TUNE: Exclude installers\n| project Timestamp, DeviceName, RegistryKey, RegistryValueName, RegistryValueData, InitiatingProcessFileName, InitiatingProcessCommandLine\n| order by Timestamp desc\n\n// VALIDATE: Legitimate software installations modify these keys\n// TUNE: Baseline normal software deployment processes`},
      {name:'Scheduled Task Creation',mitre:['T1053.005'],desc:'Detect new scheduled tasks created outside business hours or by uncommon users',query:`// Hunt: Suspicious Scheduled Task Creation\n// MITRE: T1053.005 - Scheduled Task/Job\n\nDeviceProcessEvents\n| where Timestamp > ago(7d)\n| where FileName =~ "schtasks.exe" and ProcessCommandLine has "/create"\n| where hourofday(Timestamp) !between (8 .. 18) // After hours\n| project Timestamp, DeviceName, AccountName, ProcessCommandLine, InitiatingProcessFileName\n| order by Timestamp desc\n\n// TUNE: Adjust business hours based on your org\n// VALIDATE: Patch deployment and backup tasks may run after hours`}
    ],
    'Exfiltration':[
      {name:'Large Data Upload to Cloud Storage',mitre:['T1567.002'],desc:'Hunt for abnormal data uploads to Dropbox/OneDrive/Google Drive',query:`// Hunt: Cloud Exfiltration Detection\n// MITRE: T1567.002 - Exfiltration to Cloud Storage\n\nDeviceNetworkEvents\n| where Timestamp > ago(24h)\n| where RemoteUrl has_any ("dropbox.com", "drive.google.com", "onedrive.live.com", "box.com")\n| where ActionType == "ConnectionSuccess"\n| summarize TotalBytesSent=sum(BytesSent), ConnectionCount=count() by DeviceName, AccountName, RemoteUrl\n| where TotalBytesSent > 104857600 // 100MB threshold\n| extend TotalMB = TotalBytesSent / 1048576\n| project DeviceName, AccountName, RemoteUrl, TotalMB, ConnectionCount\n| order by TotalMB desc\n\n// TUNE: Adjust threshold based on normal user behavior\n// VALIDATE: Sales/Marketing may legitimately upload large files`},
      {name:'DNS Tunneling Detection',mitre:['T1071.004'],desc:'Identify potential DNS exfiltration via abnormally long queries',query:`// Hunt: DNS Tunneling\n// MITRE: T1071.004 - DNS Application Layer Protocol\n\nDeviceNetworkEvents\n| where Timestamp > ago(24h)\n| where RemotePort == 53\n| extend QueryLength = strlen(RemoteUrl)\n| where QueryLength > 60 // Abnormally long DNS query\n| summarize QueryCount=count(), UniqueQueries=dcount(RemoteUrl) by DeviceName, RemoteIP\n| where QueryCount > 50\n| order by QueryCount desc\n\n// TUNE: Baseline normal DNS query lengths in your environment\n// VALIDATE: Some CDN/cloud services use long DNS names`}
    ],
    'Initial Access':[
      {name:'Phishing - Suspicious Email Attachment Execution',mitre:['T1566.001'],desc:'Hunt for execution of files shortly after email receipt with dangerous extensions',query:`// Hunt: Email Attachment Execution Chain\n// MITRE: T1566.001 - Spearphishing Attachment\n\nlet EmailAttachments = EmailAttachmentInfo\n| where Timestamp > ago(24h)\n| where FileType in~ ("exe", "zip", "rar", "iso", "vbs", "js", "hta")\n| project EmailTimestamp=Timestamp, RecipientEmailAddress, FileName, SHA256;\nDeviceFileEvents\n| where Timestamp > ago(24h)\n| where ActionType == "FileCreated"\n| join kind=inner EmailAttachments on $left.SHA256 == $right.SHA256\n| where Timestamp between ((EmailTimestamp - 5m) .. (EmailTimestamp + 30m))\n| project Timestamp, DeviceName, RecipientEmailAddress, FileName, FolderPath, InitiatingProcessFileName\n| order by Timestamp desc\n\n// VALIDATE: Users may legitimately download tools\n// ENRICH: Check attachment against VirusTotal`}
    ]
  },
  defender:{
    'Credential Access':[
      {name:'Kerberoasting Activity',mitre:['T1558.003'],desc:'Detect TGS requests for service accounts (potential Kerberoasting)',query:`// Hunt: Kerberoasting Detection\n// MITRE: T1558.003 - Kerberoasting\n\nDeviceEvents\n| where Timestamp > ago(24h)\n| where ActionType == "KerberosTgsRequested"\n| where TicketEncryptionType != "0x12" // Not AES\n| summarize TGSCount=count(), SPNs=make_set(ServicePrincipalName) by AccountName, DeviceName\n| where TGSCount >= 10\n| order by TGSCount desc\n\n// TUNE: Lower threshold in small environments\n// VALIDATE: Service discovery tools may trigger this`},
      {name:'DCSync Attack Pattern',mitre:['T1003.006'],desc:'Hunt for suspicious replication requests to domain controllers',query:`// Hunt: DCSync Detection\n// MITRE: T1003.006 - DCSync\n\nDeviceEvents\n| where Timestamp > ago(24h)\n| where ActionType has "DirectoryServiceReplication"\n| where InitiatingProcessAccountName !endswith "$" // Exclude computer accounts\n| project Timestamp, DeviceName, InitiatingProcessAccountName, TargetAccountName, ActionType\n| order by Timestamp desc\n\n// VALIDATE: Backup software and DC replication are legitimate\n// ENRICH: Cross-reference with AD privileged accounts list`}
    ],
    'Execution':[
      {name:'Living-off-the-Land Binaries (LOLBins)',mitre:['T1218'],desc:'Detect abuse of legitimate Windows binaries for malicious execution',query:`// Hunt: LOLBin Execution\n// MITRE: T1218 - System Binary Proxy Execution\n\nDeviceProcessEvents\n| where Timestamp > ago(24h)\n| where FileName in~ ("certutil.exe", "bitsadmin.exe", "regsvr32.exe", "mshta.exe", "rundll32.exe")\n| where ProcessCommandLine has_any ("http", "download", "-decode", "scrobj.dll")\n| project Timestamp, DeviceName, AccountName, FileName, ProcessCommandLine, InitiatingProcessFileName\n| order by Timestamp desc\n\n// VALIDATE: Legitimate admin scripts may use these\n// TUNE: Add common benign command patterns to exclusions`},
      {name:'PowerShell Obfuscation',mitre:['T1059.001'],desc:'Hunt for heavily obfuscated or encoded PowerShell commands',query:`// Hunt: Obfuscated PowerShell\n// MITRE: T1059.001 - PowerShell\n\nDeviceProcessEvents\n| where Timestamp > ago(24h)\n| where FileName =~ "powershell.exe"\n| where ProcessCommandLine has_any ("-enc", "-w hidden", "bypass", "IEX", "downloadstring")\n| extend CommandLength = strlen(ProcessCommandLine)\n| where CommandLength > 500 // Long commands often obfuscated\n| project Timestamp, DeviceName, AccountName, ProcessCommandLine, InitiatingProcessFileName\n| order by Timestamp desc\n\n// TUNE: Exclude known deployment scripts\n// VALIDATE: Some security tools use encoded PowerShell`}
    ],
    'Defense Evasion':[
      {name:'Windows Defender Tampering',mitre:['T1562.001'],desc:'Detect attempts to disable or bypass Windows Defender',query:`// Hunt: Defender Tampering\n// MITRE: T1562.001 - Impair Defenses\n\nDeviceProcessEvents\n| where Timestamp > ago(7d)\n| where ProcessCommandLine has_any (\n    "Set-MpPreference -DisableRealtimeMonitoring",\n    "DisableAntiSpyware",\n    "DisableBehaviorMonitoring",\n    "sc config windefend"\n)\n| project Timestamp, DeviceName, AccountName, ProcessCommandLine, InitiatingProcessFileName\n| order by Timestamp desc\n\n// VALIDATE: IT may temporarily disable for troubleshooting\n// ESCALATE: High-priority alert - immediate investigation required`},
      {name:'Event Log Clearing',mitre:['T1070.001'],desc:'Hunt for suspicious clearing of Windows event logs',query:`// Hunt: Event Log Clearing\n// MITRE: T1070.001 - Clear Windows Event Logs\n\nDeviceProcessEvents\n| where Timestamp > ago(7d)\n| where ProcessCommandLine has_any ("wevtutil cl", "Clear-EventLog")\n| project Timestamp, DeviceName, AccountName, ProcessCommandLine, InitiatingProcessFileName\n| order by Timestamp desc\n\n// VALIDATE: Scheduled cleanup scripts may clear old logs\n// ENRICH: Correlate with other suspicious activity on same host`}
    ]
  },
  crowdstrike:{
    'Execution':[
      {name:'Suspicious Process Creation Chain',mitre:['T1059'],desc:'Hunt for unusual parent-child process relationships indicating execution abuse',query:`// Hunt: Anomalous Process Tree\n// MITRE: T1059 - Command and Scripting Interpreter\n// Platform: CrowdStrike Falcon\n\nevent_simpleName=ProcessRollup2\n| ParentBaseFileName IN ("winword.exe", "excel.exe", "outlook.exe")\n| FileName IN ("powershell.exe", "cmd.exe", "wscript.exe", "cscript.exe")\n| table ComputerName, UserName, ParentBaseFileName, FileName, CommandLine\n\n// TUNE: Macros may legitimately spawn processes in some orgs\n// VALIDATE: Check if document is from trusted source`},
      {name:'Cobalt Strike Beacon Detection',mitre:['T1071.001'],desc:'Hunt for potential Cobalt Strike C2 beaconing patterns',query:`// Hunt: Cobalt Strike Network Indicators\n// MITRE: T1071.001 - Web Protocols\n// Platform: CrowdStrike Falcon\n\nevent_simpleName=NetworkConnectIP4\n| RemotePort IN ("80", "443", "8080", "8443")\n| LocalAddressIP4!=RemoteAddressIP4\n| stats dc(RemoteAddressIP4) as UniqueIPs, count() as ConnCount by aid, UserName\n| where ConnCount > 50 AND UniqueIPs < 5\n\n// TUNE: Beaconing creates repetitive connection patterns\n// ENRICH: Analyze connection timing intervals for regularity`}
    ],
    'Persistence':[
      {name:'WMI Event Subscription',mitre:['T1546.003'],desc:'Detect WMI event subscriptions used for persistence',query:`// Hunt: WMI Persistence\n// MITRE: T1546.003 - Windows Management Instrumentation Event Subscription\n// Platform: CrowdStrike Falcon\n\nevent_simpleName=AsepValueUpdate\n| RegistryPath="*\\\\Subscription\\\\*"\n| RegistryValueName IN ("__EventFilter", "__EventConsumer", "__FilterToConsumerBinding")\n| table ComputerName, RegistryPath, RegistryValueName, RegistryValueData\n\n// VALIDATE: System monitoring tools use WMI subscriptions\n// TUNE: Baseline expected WMI consumers in your environment`}
    ],
    'Credential Access':[
      {name:'Browser Credential Theft',mitre:['T1555.003'],desc:'Hunt for access to browser credential stores (Chrome, Edge, Firefox)',query:`// Hunt: Browser Credential Access\n// MITRE: T1555.003 - Credentials from Web Browsers\n// Platform: CrowdStrike Falcon\n\nevent_simpleName=FileOpenInfo\n| FileName IN ("Login Data", "logins.json", "key4.db", "Cookies")\n| FilePath="*\\\\AppData\\\\*"\n| table ComputerName, UserName, FileName, FilePath, ContextProcessId_decimal\n\n// VALIDATE: Browsers access these files during normal operation\n// ENRICH: Check if accessing process is legitimate browser`}
    ]
  }
};

function updateQueryCategories(){
  const platform=document.getElementById('queryPlatform').value;
  const categorySelect=document.getElementById('queryCategory');
  const nameSelect=document.getElementById('queryName');
  
  categorySelect.innerHTML='<option value="">-- Select Category --</option>';
  nameSelect.innerHTML='<option value="">-- Select Hunt Query --</option>';
  nameSelect.disabled=true;
  document.getElementById('queryDetailsContainer').style.display='none';
  document.getElementById('queryPlaceholder').style.display='block';
  
  if(platform&&huntingQueries[platform]){
    Object.keys(huntingQueries[platform]).forEach(cat=>{
      const opt=document.createElement('option');
      opt.value=cat;
      opt.textContent=cat;
      categorySelect.appendChild(opt);
    });
    categorySelect.disabled=false;
  }else{
    categorySelect.disabled=true;
  }
}

function updateQueryList(){
  const platform=document.getElementById('queryPlatform').value;
  const category=document.getElementById('queryCategory').value;
  const nameSelect=document.getElementById('queryName');
  
  nameSelect.innerHTML='<option value="">-- Select Hunt Query --</option>';
  document.getElementById('queryDetailsContainer').style.display='none';
  document.getElementById('queryPlaceholder').style.display='block';
  
  if(platform&&category&&huntingQueries[platform][category]){
    huntingQueries[platform][category].forEach((q,idx)=>{
      const opt=document.createElement('option');
      opt.value=idx;
      opt.textContent=q.name;
      nameSelect.appendChild(opt);
    });
    nameSelect.disabled=false;
  }else{
    nameSelect.disabled=true;
  }
}

function displayQuery(){
  const platform=document.getElementById('queryPlatform').value;
  const category=document.getElementById('queryCategory').value;
  const queryIdx=document.getElementById('queryName').value;
  
  if(platform&&category&&queryIdx!==''){
    const query=huntingQueries[platform][category][parseInt(queryIdx)];
    
    document.getElementById('queryTitle').textContent=query.name;
    document.getElementById('queryDescription').textContent=query.desc;
    document.getElementById('queryPlatformTag').textContent=document.getElementById('queryPlatform').options[document.getElementById('queryPlatform').selectedIndex].text;
    
    const mitreHtml=query.mitre.map(t=>`<span class="tag high">${t}</span>`).join('');
    document.getElementById('queryMitre').innerHTML=mitreHtml;
    
    document.getElementById('queryOutput').textContent=query.query;
    
    document.getElementById('queryDetailsContainer').style.display='block';
    document.getElementById('queryPlaceholder').style.display='none';
  }
}

function toggleTheme(){const body=document.body,current=body.getAttribute('data-theme'),newTheme=current==='light'?'dark':'light';body.setAttribute('data-theme',newTheme);document.getElementById('themeIcon').className=newTheme==='light'?'fas fa-moon':'fas fa-sun';document.getElementById('themeText').textContent=newTheme==='light'?'Dark':'Light';localStorage.setItem('theme',newTheme);}
function switchTab(tab){document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));document.getElementById('tab-'+tab).classList.add('active');event.target.classList.add('active');currentTab=tab;if(tab==='osint'&&!document.getElementById('osintKeyboard').innerHTML)loadOSINTKeyboard();}
function copyToClipboard(elementId){navigator.clipboard.writeText(document.getElementById(elementId).textContent).then(()=>{const btn=event.target.closest('.copy-btn'),originalText=btn.innerHTML;btn.innerHTML='<i class="fas fa-check"></i> Copied!';setTimeout(()=>btn.innerHTML=originalText,2000);}).catch(()=>alert('Failed to copy.'));}
function loadActiveThreatCards(){document.getElementById('activeThreatCards').innerHTML=`<div class="threat-card critical"><h4>Qilin & Clop Ransomware (Dec 2025)</h4><div class="description">15% of global attacks each</div><div class="action"><strong>Action:</strong> Monitor Oracle EBS</div></div><div class="threat-card high"><h4>Warlock Ransomware</h4><div class="description">SharePoint zero-day exploitation</div><div class="action"><strong>Action:</strong> Patch SharePoint</div></div>`;}

const rssFeeds=['https://www.bleepingcomputer.com/feed/','https://feeds.feedburner.com/TheHackersNews','https://krebsonsecurity.com/feed/','https://www.securityweek.com/feed/','https://www.darkreading.com/rss.xml'];
async function fetchFeed(url){try{const resp=await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`);const data=await resp.json();if(data.status==='ok'){return data.items.slice(0,10).map(item=>({title:item.title||'No title',link:item.link||'#',pubDate:item.pubDate||'',description:(item.description||'').replace(/<[^>]+>/g,'').slice(0,450),source:new URL(url).hostname,tags:autoTagArticle(item.title+' '+item.description)}));}return[];}catch(e){return[];}}
async function loadFeeds(){const area=document.getElementById('feedArea');area.innerHTML='<div class="loading"><i class="fas fa-spinner"></i><p>Loading...</p></div>';allArticles=[];const results=await Promise.all(rssFeeds.map(f=>fetchFeed(f)));results.forEach(items=>allArticles.push(...items));allArticles.sort((a,b)=>new Date(b.pubDate)-new Date(a.pubDate));applyFeedFilters();}
function autoTagArticle(text){const lower=text.toLowerCase();const tags=[];if(lower.match(/ransom|lockbit|blackcat|qilin|clop/))tags.push({name:'Ransomware',type:'critical'});if(lower.match(/zero.?day/))tags.push({name:'Zero-Day',type:'critical'});if(lower.match(/apt\d+|apt\s/))tags.push({name:'APT',type:'high'});if(lower.match(/phish/))tags.push({name:'Phishing',type:'high'});if(lower.match(/malware/))tags.push({name:'Malware',type:'high'});return tags;}
function applyFeedFilters(){const timeFilter=document.getElementById('feedFilter').value;const searchTerm=document.getElementById('feedSearch').value.toLowerCase();let filtered=allArticles;if(timeFilter!=='all'){const now=new Date();filtered=filtered.filter(article=>{const articleDate=new Date(article.pubDate);const diff=now-articleDate;switch(timeFilter){case'today':return now.toDateString()===articleDate.toDateString();case'24h':return diff<=86400000;case'7d':return diff<=604800000;default:return true;}});}if(searchTerm){filtered=filtered.filter(a=>(a.title+a.description).toLowerCase().includes(searchTerm));}displayFeeds(filtered.slice(0,50));}
function displayFeeds(articles){const area=document.getElementById('feedArea');if(!articles.length){area.innerHTML='<p style="text-align:center;color:var(--text-tertiary);padding:2rem 0">No articles found.</p>';return;}area.innerHTML=articles.map(a=>`<div class="feed-item"><a href="${a.link}" target="_blank" rel="noopener">${a.title}</a>${a.description?`<div class="description">${a.description}</div>`:''}<div class="meta"><span><i class="fas fa-clock"></i> ${getTimeAgo(new Date(a.pubDate))}</span><span><i class="fas fa-globe"></i> ${a.source}</span></div>${a.tags.length?`<div class="tags">${a.tags.map(t=>`<span class="tag ${t.type}">${t.name}</span>`).join('')}</div>`:''}</div>`).join('');}
function getTimeAgo(date){const seconds=Math.floor((new Date()-date)/1000);if(seconds<3600)return Math.floor(seconds/60)+'m ago';if(seconds<86400)return Math.floor(seconds/3600)+'h ago';if(seconds<604800)return Math.floor(seconds/86400)+'d ago';return date.toLocaleDateString();}

function generateHypothesis(){const container=document.getElementById('hypothesisContainer');const loading=document.getElementById('hypothesisLoading');if(!allArticles.length){alert('Please wait for feeds to load first.');return;}loading.style.display='block';container.innerHTML='';setTimeout(()=>{loading.style.display='none';const templates=[{title:a=>`Hunt for shadow IT exploiting "${a.title.slice(0,50)}..."`,hypothesis:a=>'Adversaries may abuse this incident to exfiltrate data via unsanctioned cloud services. Monitor unusual outbound connections to file-sharing platforms.',context:a=>`<strong>Threat Context:</strong> Employees may bypass security controls during ${new Date(a.pubDate).toLocaleDateString()}<br><strong>TTPs:</strong> Data Exfiltration (T1041), Cloud Service Abuse (T1567)<br><strong>Hunt Query:</strong> DeviceNetworkEvents | where RemoteUrl has_any ("dropbox","drive.google","mega.nz")`},{title:a=>`Investigate if "${a.title.slice(0,50)}..." masks APT activity`,hypothesis:a=>'This high-profile event may hide stealthier targeted attacks. Threat actors leverage breaking news to blend malicious C2 traffic with legitimate communications.',context:a=>`<strong>Threat Context:</strong> APT groups capitalize on media attention to hide infrastructure<br><strong>TTPs:</strong> Command and Control (T1071), Obfuscation (T1027)<br><strong>Hunt Query:</strong> Look for beaconing patterns in proxy logs coinciding with ${new Date(a.pubDate).toLocaleDateString()}`},{title:a=>`Hunt for phishing campaigns weaponizing "${a.title.slice(0,50)}..."`,hypothesis:a=>'Attackers rapidly weaponize breaking security news into phishing lures. Expect surge in themed credential harvesting within 24-48 hours of this disclosure.',context:a=>`<strong>Threat Context:</strong> Phishing activity peaks immediately following major security incidents<br><strong>TTPs:</strong> Spearphishing (T1566), Credential Harvesting<br><strong>Hunt Query:</strong> EmailEvents | where Subject contains keywords from article AND TimeGenerated > ago(48h)`},{title:a=>`Investigate supply chain risk from "${a.title.slice(0,50)}..."`,hypothesis:a=>'Third-party vendors mentioned in this article may be compromised, creating cascading supply chain risk to your organization and partners.',context:a=>`<strong>Threat Context:</strong> Breaches disclosed on ${new Date(a.pubDate).toLocaleDateString()} often have upstream/downstream impacts<br><strong>TTPs:</strong> Supply Chain Compromise (T1195)<br><strong>Hunt Query:</strong> Monitor vendor-related authentication events and data flows`},{title:a=>`Probe for insider threats amplifying "${a.title.slice(0,50)}..."`,hypothesis:a=>'Internal actors may exploit this external distraction to exfiltrate sensitive data while security teams are focused on the publicized threat.',context:a=>`<strong>Threat Context:</strong> Insider threat activity increases during major security events<br><strong>TTPs:</strong> Data Staged (T1074), Removable Media (T1052)<br><strong>Hunt Query:</strong> Monitor USB connections, after-hours file access, and unusual SharePoint downloads`}];const hypotheses=allArticles.slice(0,10).map((a,i)=>{const template=templates[i%templates.length];return{title:template.title(a),hypothesis:template.hypothesis(a),context:template.context(a)};});container.innerHTML=hypotheses.map((h,i)=>`<div class="hypothesis-item"><h4>${i+1}. ${h.title}</h4><p><strong>Hypothesis:</strong> ${h.hypothesis}</p><div class="context">${h.context}</div></div>`).join('');},1500);}

const osintTools=[{key:'A',name:'AbuseIPDB',url:'https://www.abuseipdb.com/check'},{key:'B',name:'BGPView',url:'https://bgpview.io'},{key:'C',name:'Censys',url:'https://search.censys.io'},{key:'D',name:'DNSTrails',url:'https://securitytrails.com/domain'},{key:'E',name:'IPVoid',url:'https://www.ipvoid.com/domain-reputation-check/'},{key:'F',name:'Fofa',url:'https://en.fofa.info'},{key:'G',name:'GreyNoise',url:'https://viz.greynoise.io/query'},{key:'H',name:'Hybrid Analysis',url:'https://www.hybrid-analysis.com'},{key:'I',name:'IPinfo',url:'https://ipinfo.io/'},{key:'J',name:'JoeSandbox',url:'https://www.joesandbox.com'},{key:'K',name:'Kaspersky TI',url:'https://opentip.kaspersky.com'},{key:'L',name:'DNSlytics',url:'https://dnslytics.com/'},{key:'M',name:'Maltiverse',url:'https://www.maltiverse.com/search'},{key:'N',name:'Netlas',url:'https://app.netlas.io'},{key:'O',name:'Onyphe',url:'https://www.onyphe.io'},{key:'P',name:'Pulsedive',url:'https://pulsedive.com'},{key:'Q',name:'Talos Intel',url:'https://www.talosintelligence.com/reputation_center'},{key:'R',name:'AlienVault OTX',url:'https://otx.alienvault.com'},{key:'S',name:'Shodan',url:'https://www.shodan.io/search'},{key:'T',name:'ThreatFox',url:'https://threatfox.abuse.ch'},{key:'U',name:'URLScan',url:'https://urlscan.io'},{key:'V',name:'VirusTotal',url:'https://www.virustotal.com/gui/home/upload'},{key:'W',name:'WHOIS',url:'https://whois.domaintools.com'},{key:'X',name:'X-Force',url:'https://exchange.xforce.ibmcloud.com'},{key:'Y',name:'YARAify',url:'https://yaraify.abuse.ch'},{key:'Z',name:'ZoomEye',url:'https://www.zoomeye.org'}];
function loadOSINTKeyboard(){document.getElementById('osintKeyboard').innerHTML=osintTools.map(t=>`<a href="${t.url}" target="_blank" class="osint-key" accesskey="${t.key.toLowerCase()}"><div class="letter">${t.key}</div><div class="tool-name">${t.name}</div></a>`).join('');}
document.addEventListener('keydown',e=>{if(currentTab==='osint'&&e.key.match(/[a-z]/i)&&!e.ctrlKey&&!e.altKey&&!e.metaKey){const tool=osintTools.find(t=>t.key.toLowerCase()===e.key.toLowerCase());if(tool){window.open(tool.url,'_blank');e.preventDefault();}}});

let extractedIOCs={ips:[],domains:[],urls:[],hashes:[]};
function defangIOC(text){return text.replace(/\[\.\.\]/g,'.').replace(/\[\.\]/g,'.').replace(/\[:\]/g,':').replace(/hxxp/gi,'http');}
function extractIOCs(){let text=document.getElementById('iocInput').value;if(!text.trim()){alert('Please paste text first.');return;}text=defangIOC(text);extractedIOCs={ips:[],domains:[],urls:[],hashes:[]};extractedIOCs.ips=[...new Set(text.match(/\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b/g)||[])].filter(ip=>ip.split('.').every(octet=>parseInt(octet)>=0&&parseInt(octet)<=255));extractedIOCs.domains=[...new Set(text.match(/\b(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z]{2,}\b/gi)||[])].filter(d=>!d.match(/\.(exe|dll|txt|log|jpg|png|pdf)$/i)&&!extractedIOCs.ips.includes(d));extractedIOCs.urls=[...new Set(text.match(/https?:\/\/[^\s<>"{}|\\\^`\[\]]+/gi)||[])];extractedIOCs.hashes=[...new Set(text.match(/\b[a-f0-9]{32}\b|\b[a-f0-9]{40}\b|\b[a-f0-9]{64}\b/gi)||[])];const results=document.getElementById('iocResults');let html='',total=0;const addSection=(title,items,type)=>{if(items.length){html+=`<div style="margin-bottom:1rem"><strong>${title} (${items.length})</strong></div>`;items.forEach(item=>{html+=`<div class="ioc-item"><code style="word-break:break-all;color:var(--text-secondary);font-size:.8125rem">${item}</code><span class="ioc-type">${type}</span></div>`;});total+=items.length;}};addSection('IP Addresses',extractedIOCs.ips,'IP');addSection('Domains',extractedIOCs.domains,'DOMAIN');addSection('URLs',extractedIOCs.urls,'URL');addSection('Hashes',extractedIOCs.hashes,'HASH');results.innerHTML=html||'<p style="text-align:center;color:var(--text-tertiary);padding:2rem 0">No IOCs found.</p>';if(total>0){results.innerHTML=`<div style="background:var(--success-light);color:var(--success);padding:.75rem;border-radius:var(--radius);margin-bottom:1rem;text-align:center;font-weight:500;border:1px solid var(--success)">Extracted ${total} IOCs</div>`+results.innerHTML;}}
function exportIOCs(format){const total=extractedIOCs.ips.length+extractedIOCs.domains.length+extractedIOCs.urls.length+extractedIOCs.hashes.length;if(!total){alert('No IOCs to export.');return;}let content='';const date=new Date().toISOString().slice(0,10);if(format==='txt'){content='=== IP Addresses ===\n'+extractedIOCs.ips.join('\n')+'\n\n=== Domains ===\n'+extractedIOCs.domains.join('\n')+'\n\n=== URLs ===\n'+extractedIOCs.urls.join('\n')+'\n\n=== Hashes ===\n'+extractedIOCs.hashes.join('\n');}else if(format==='json'){content=JSON.stringify(extractedIOCs,null,2);}else if(format==='csv'){content='Type,Value\n';extractedIOCs.ips.forEach(ip=>content+=`IP,${ip}\n`);extractedIOCs.domains.forEach(d=>content+=`Domain,${d}\n`);extractedIOCs.urls.forEach(u=>content+=`URL,${u}\n`);extractedIOCs.hashes.forEach(h=>content+=`Hash,${h}\n`);}const blob=new Blob([content],{type:format==='json'?'application/json':'text/plain'}),url=URL.createObjectURL(blob),a=document.createElement('a');a.href=url;a.download=`iocs_${date}.${format}`;a.click();URL.revokeObjectURL(url);}

const savedTheme=localStorage.getItem('theme')||'light';document.body.setAttribute('data-theme',savedTheme);if(savedTheme==='dark'){document.getElementById('themeIcon').className='fas fa-sun';document.getElementById('themeText').textContent='Light';}
setInterval(()=>{document.getElementById('clock').textContent=new Date().toLocaleString('en-US',{weekday:'short',year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});},1000);
window.addEventListener('load',()=>{loadFeeds();loadActiveThreatCards();});
  </script>
</body>
</html>